<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°ì…‰ğŸ’â€â™€ï¸ & ë‹¤ë‹ˆì—˜ğŸ’â€â™‚ï¸ ì •ì‚° ì‹œìŠ¤í…œ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        button.delete-btn {
            background-color: #f44336;
            width: auto;
            padding: 5px 10px;
            font-size: 12px;
            margin-top: 0;
        }
        button.delete-btn:hover {
            background-color: #d32f2f;
        }
        #result {
            margin-top: 20px;
            display: none;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        .history-details {
            flex-grow: 1;
        }
        .category {
            font-weight: bold;
            color: #2c3e50;
        }
        .final-result {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 5px;
        }
        .expense-type {
            margin-top: 5px;
            padding: 5px;
            border-radius: 3px;
            font-size: 12px;
            display: inline-block;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #eef;
            border-radius: 5px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .currency {
            font-family: monospace;
        }
        .date-tab {
            margin-top: 15px;
            padding: 8px;
            background: #e0e0e0;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        .date-history {
            display: none;
        }
        .date-history.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‘¬ ì¡°ì…‰ğŸ’â€â™€ï¸ & ë‹¤ë‹ˆì—˜ğŸ’â€â™‚ï¸ ì •ì‚° ($)</h1>
        
        <div class="form-group">
            <label for="payer">ê²°ì œì</label>
            <select id="payer">
                <option value="ì¡°ì…‰">ì¡°ì…‰ğŸ’â€â™€ï¸</option>
                <option value="ë‹¤ë‹ˆì—˜">ë‹¤ë‹ˆì—˜ğŸ’â€â™‚ï¸</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="category">í•­ëª©</label>
            <select id="category">
                <option value="ì¥ë³´ê¸°">ğŸ›’ ì¥ë³´ê¸° (ê³µìš©)</option>
                <option value="ì£¼ìœ ">â›½ ì£¼ìœ  (ê³µìš©)</option>
                <option value="ì™¸ì‹">ğŸ½ï¸ ì™¸ì‹ (ê³µìš©)</option>
                <option value="ì¡°ì…‰ ê°œì¸">ğŸ‘¤ ì¡°ì…‰ğŸ’â€â™€ï¸ ê°œì¸ ì§€ì¶œ</option>
                <option value="ë‹¤ë‹ˆì—˜ ê°œì¸">ğŸ‘¤ ë‹¤ë‹ˆì—˜ğŸ’â€â™‚ï¸ ê°œì¸ ì§€ì¶œ</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="amount">ê¸ˆì•¡ ($)</label>
            <input type="number" id="amount" placeholder="ì˜ˆ) 15.00" step="0.01">
        </div>
        
        <button onclick="addRecord()">ê¸°ë¡ ì¶”ê°€</button>
        
        <div id="result">
            <div class="summary" id="summary">
                <div class="summary-item">
                    <span>ì¡°ì…‰ğŸ’â€â™€ï¸ ì´ ì§€ì¶œ:</span>
                    <span class="currency" id="totalJoseph">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>ë‹¤ë‹ˆì—˜ğŸ’â€â™‚ï¸ ì´ ì§€ì¶œ:</span>
                    <span class="currency" id="totalDaniel">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>ê³µìš© ì§€ì¶œ í•©ê³„:</span>
                    <span class="currency" id="totalShared">$0.00</span>
                </div>
            </div>
            <div class="final-result" id="finalResult"></div>
            <div id="dateTabs"></div>
            <div id="historyList"></div>
        </div>
    </div>

    <script>
        let totalJoseph = 0;
        let totalDaniel = 0;
        let totalShared = 0;
        let history = {};

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadHistory() {
            const savedHistory = localStorage.getItem('settlementHistory');
            if (savedHistory) {
                history = JSON.parse(savedHistory);
                updateDateTabs();
            } else {
                history = {};
                const today = new Date().toISOString().split('T')[0];
                history[today] = [];
                saveHistory();
            }
        }

        // ê¸°ë¡ ì €ì¥
        function saveHistory() {
            localStorage.setItem('settlementHistory', JSON.stringify(history));
        }

        // ë‚ ì§œ íƒ­ ìƒì„±
        function updateDateTabs() {
            const dateTabs = document.getElementById('dateTabs');
            dateTabs.innerHTML = '';
            
            const dates = Object.keys(history).sort().reverse();
            dates.forEach(date => {
                const tab = document.createElement('div');
                tab.className = 'date-tab';
                tab.textContent = date;
                tab.onclick = () => toggleDateHistory(date);
                dateTabs.appendChild(tab);
            });
            
            // ê°€ì¥ ìµœê·¼ ë‚ ì§œ ìë™ í‘œì‹œ
            if (dates.length > 0) {
                toggleDateHistory(dates[0]);
            }
        }

        // ë‚ ì§œë³„ ê¸°ë¡ í† ê¸€
        function toggleDateHistory(date) {
            const allHistories = document.querySelectorAll('.date-history');
            allHistories.forEach(div => div.classList.remove('active'));
            
            let historyDiv = document.getElementById(`history-${date}`);
            if (!historyDiv) {
                historyDiv = document.createElement('div');
                historyDiv.id = `history-${date}`;
                historyDiv.className = 'date-history';
                document.getElementById('historyList').appendChild(historyDiv);
            }
            
            historyDiv.classList.add('active');
            renderHistory(date);
        }

        // ê¸°ë¡ ë Œë”ë§
        function renderHistory(date) {
            const historyDiv = document.getElementById(`history-${date}`);
            if (!historyDiv) return;
            
            historyDiv.innerHTML = '';
            
            if (!history[date] || history[date].length === 0) {
                historyDiv.innerHTML = "<div style='text-align:center;padding:20px;color:#777;'>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>";
                return;
            }
            
            history[date].forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                
                const typeLabel = document.createElement('span');
                typeLabel.className = 'expense-type';
                typeLabel.textContent = item.isShared ? "ê³µìš© ì§€ì¶œ (ë°˜ì”© ë¶„í• )" : "ê°œì¸ ì§€ì¶œ (ì „ì•¡ ì •ì‚°)";
                typeLabel.style.backgroundColor = item.isShared ? "#e3f2fd" : "#ffebee";
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'ì‚­ì œ';
                deleteBtn.onclick = () => deleteRecord(date, item.id);
                
                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'history-details';
                
                const payerWithGender = item.payer === "ì¡°ì…‰" ? "ì¡°ì…‰â™€" : "ë‹¤ë‹ˆì—˜â™‚";
                const categoryWithGender = item.category.replace("ì¡°ì…‰", "ì¡°ì…‰â™€").replace("ë‹¤ë‹ˆì—˜", "ë‹¤ë‹ˆì—˜â™‚");
                
                detailsDiv.innerHTML = `
                    <div>
                        <span class="category">${categoryWithGender}</span>
                        <span>(${payerWithGender})</span>
                        <div style="font-size:12px; color:#777;">${item.time}</div>
                    </div>
                    <div style="font-weight:bold;" class="currency">${formatCurrency(item.amount)}</div>
                `;
                
                detailsDiv.insertBefore(typeLabel, detailsDiv.firstChild);
                div.appendChild(detailsDiv);
                div.appendChild(deleteBtn);
                historyDiv.appendChild(div);
            });
        }

        function formatCurrency(amount) {
            return '$' + amount.toFixed(2);
        }

        function addRecord() {
            const payer = document.getElementById('payer').value.replace(/[â™€â™‚]/g, '').trim();
            const category = document.getElementById('category').value;
            const amount = parseFloat(document.getElementById('amount').value);
            
            if (isNaN(amount)) {
                alert("ê¸ˆì•¡ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            if (!history[today]) history[today] = [];
            
            const record = {
                id: Date.now(),
                payer,
                category,
                amount,
                isShared: !category.includes("ê°œì¸"),
                time: new Date().toLocaleTimeString()
            };

            history[today].push(record);
            saveHistory();
            calculateTotals();
            updateDisplay();
            document.getElementById('amount').value = "";
        }

        function calculateTotals() {
            totalJoseph = 0;
            totalDaniel = 0;
            totalShared = 0;

            Object.values(history).flat().forEach(item => {
                if (item.isShared) {
                    const sharedAmount = item.amount / 2;
                    if (item.payer === "ì¡°ì…‰") {
                        totalJoseph += sharedAmount;
                    } else {
                        totalDaniel += sharedAmount;
                    }
                    totalShared += item.amount;
                } else {
                    if (item.category.includes("ë‹¤ë‹ˆì—˜ ê°œì¸")) {
                        totalDaniel += item.amount;
                    } else if (item.category.includes("ì¡°ì…‰ ê°œì¸")) {
                        totalJoseph += item.amount;
                    }
                }
            });
        }

        function deleteRecord(date, id) {
            const index = history[date].findIndex(item => item.id === id);
            if (index !== -1) {
                history[date].splice(index, 1);
                saveHistory();
                calculateTotals();
                updateDisplay();
            }
        }

        function updateDisplay() {
            updateResult();
            updateDateTabs();
            updateSummary();
            document.getElementById('result').style.display = "block";
        }

        function updateResult() {
            const diff = Math.abs(totalJoseph - totalDaniel);
            let result = "";

            if (totalJoseph > totalDaniel) {
                result = `ë‹¤ë‹ˆì—˜ â†’ ì¡°ì…‰ ì—ê²Œ ${formatCurrency(diff)} ë³´ë‚´ê¸°`;
            } else if (totalDaniel > totalJoseph) {
                result = `ì¡°ì…‰ â†’ ë‹¤ë‹ˆì—˜ ì—ê²Œ ${formatCurrency(diff)} ë³´ë‚´ê¸°`;
            } else {
                result = "ì •ì‚° ì™„ë£Œ! (ê°™ì€ ê¸ˆì•¡)";
            }

            document.getElementById('finalResult').textContent = result;
        }

        function updateSummary() {
            document.getElementById('totalJoseph').textContent = formatCurrency(totalJoseph);
            document.getElementById('totalDaniel').textContent = formatCurrency(totalDaniel);
            document.getElementById('totalShared').textContent = `${formatCurrency(totalShared)} (ê° ${formatCurrency(totalShared/2)})`;
        }

        // ì´ˆê¸° ë¡œë“œ
        loadHistory();
    </script>
</body>
</html>